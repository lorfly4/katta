<div class="container mt-4">
  <!-- Header -->
  <div class="row mb-2">
    <div class="col-sm-6">
      <h1 class="m-0">Tabel Interaksi</h1>
    </div>
    <div class="col-sm-6">
      <ol class="breadcrumb float-sm-right" style="background-color: #f4f6f9">
        <li class="breadcrumb-item"><a href="#">Halaman Utama</a></li>
        <li class="breadcrumb-item active">Tabel Interaksi</li>
      </ol>
    </div>
  </div>

  <!-- Tombol dan Search -->
  <div class="d-flex justify-content-between mb-2">
    <a href="/admin-sales/interactions/tambah" class="btn btn-sm btn-success">Tambah Interaksi</a>
    <form action="/admin-sales/interactions" method="GET" class="d-flex">
      <input type="text" name="search" class="form-control form-control-sm" placeholder="Cari interaksi..." value="<%= typeof search !== 'undefined' ? search : '' %>" />
      <button type="submit" class="btn btn-sm btn-primary ml-2">Cari</button>
    </form>
  </div>

  <!-- Flash message -->
  <% if (typeof success !== 'undefined') { %>
  <div class="alert alert-success" role="alert"><%= success %></div>
  <script>
    setTimeout(function () {
      document.querySelector(".alert").remove();
    }, 3000);
  </script>
  <% } %>

  <!-- Tabel -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr class="text-center align-middle">
          <th style="width: 3em">No</th>
          <th>Nama Klien</th>
          <th>Tipe Interaksi</th>
          <th>Catatan</th>
          <th>Dibuat Oleh</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <% if (interactions && interactions.length > 0) { %> 
          <% interactions.forEach(function(interaction, idx) { %>
            <tr>
              <td class="text-center"><%= idx + 1 %></td>
              <td><%= interaction.client_name %></td>
              <td><%= interaction.type %></td>
              <td><%= interaction.notes %></td>
              <td><%= interaction.created_by_name %></td>
              <td class="text-center">
                <button type="button" class="btn btn-sm btn-info" data-toggle="modal" data-target="#detailModal" data-id="<%= interaction.id %>">
                  Detail
                </button>
                <a href="/admin-sales/interactions/edit/<%= interaction.id %>" class="btn btn-sm btn-warning">Edit</a>
                <form action="/admin-sales/interactions/delete/<%= interaction.id %>" method="POST" class="d-inline" onsubmit="return confirmDelete(event, this)">
                  <input type="hidden" name="_method" value="DELETE" />
                  <button class="btn btn-sm btn-danger">Hapus</button>
                </form>
              </td>
            </tr>
          <% }); %> 
        <% } else { %>
          <tr>
            <td class="text-center" colspan="6">Tidak ada data</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <!-- Pagination (optional) -->
  <% if (typeof pagination !== 'undefined') { %>
    <div class="d-flex justify-content-end"><%= pagination %></div>
  <% } %>
</div>

<!-- Modal -->
<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailModalLabel">Detail Interaksi</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="interactionDetails">
          <!-- Data interaksi akan dimuat di sini -->
          <p><strong>Nama Klien:</strong> <span id="clientName"></span></p>
          <p><strong>Tipe Interaksi:</strong> <span id="interactionType"></span></p>
          <p><strong>Catatan:</strong> <span id="interactionNotes"></span></p>
          <p><strong>Dibuat Oleh:</strong> <span id="createdBy"></span></p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function confirmDelete(event, form) {
    event.preventDefault();
    if (confirm("Apakah Anda yakin ingin menghapus interaksi ini?")) {
      form.submit();
    }
  }

  // Mengambil data detail interaksi dan menampilkan di dalam modal
  $('#detailModal').on('show.bs.modal', async function (event) {
    const button = $(event.relatedTarget); // Tombol "Detail"
    const interactionId = button.data('id'); // Ambil interaction ID dari tombol

    const response = await fetch(`/admin-sales/interactions/detail/${interactionId}`);
    const data = await response.json();

    // Tampilkan detail interaksi di dalam modal
    $('#clientName').text(data.client_name);
    $('#interactionType').text(data.type);
    $('#interactionNotes').text(data.notes);
    $('#createdBy').text(data.created_by_name);
  });
</script>
